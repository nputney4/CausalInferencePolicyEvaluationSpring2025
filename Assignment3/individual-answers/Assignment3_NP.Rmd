---
title: "Assignment3_NP"
output: html_document
date: "2025-04-24"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Empty working space
rm(list=ls())

#Load Packages
# Define packages that you need, 
packages_vector <- c( "haven", "dplyr",  "sandwich",  "jtools", "fBasics",  
                     "xtable",  "stargazer", "data.table", "tidyverse", "ggplot2", 
                     "AER", # AER package for ivreg command 
                     "causalweight") # for semiparametric LATE
lapply(packages_vector, require, character.only = TRUE) 

```

```{r}
# Read in the data
load("C:/Users/putne/OneDrive/Documents/CausalInferencePolicyEvaluationSpring2025/Assignment3/instructions-and-setup/AngristEvans1980_reduced.RData")
```

```{r}
desc <- fBasics::basicStats(data) %>% 
                t() %>% 
                as.data.frame() %>% 
                dplyr::select(Mean, Stdev, nobs)

print("Descriptive statistics")
print(round(desc, digits=3))

glimpse(data)
Hmisc::describe(data)
```



## Question 1 - Estimating Effect of Fertility on Male Labour Supply - OLS
### (a)
```{r}
# Only include rows which describe a married couple
data_m <- data %>% filter(msample == 1)

print("Average Age and Income of Mothers and Fathers When First Child was Born")
age_income_df <- data.frame(Parent = c("Mother", "Father"), Age = c(data_m$agem %>% mean(), data_m$aged %>% mean()),
           Income = c(data_m$incomem %>% mean(), data_m$incomed %>% mean())) %>%
  mutate(across(c(Age, Income), ~ round(.x, 2)))

age_income_df
```

It appears that, within married couples, fathers are on average slightly older and have a substantially higher income then the mothers at the time their first child is born (39000 vs. 6200). Given that the men have a much higher income, it is possible that the decision is made within the couple for women to spend more time at home on domestic chores and looking after the child, while the man continues to work. 

### (b)
```{r}
d1b <- data_m$morekids # binary: had more than two kids
y1b <- data_m$hourswd # mens hours worked per week
z1b <- data_m$samesex # binary: first two children same sex

ols.1b <- lm(d1b ~ z1b)
summ(ols.1b, robust = "HC1")

ols.2b <- ivreg(y1b ~ d1b  | z1b)
summary(ols.2, vcov = sandwich, diagnostics = TRUE)
```
Among compilers (i.e. those who have a third kid if the first two are the same sex AND do not have a third kid if the first are a different sex), it seems having more than two kids has a small positive but insignificant effect on the number of hours worked for the fathers.

### (c)
```{r}
d1c <- data_m$morekids # binary: had more than two kids
y1c <- data_m$hourswd # mens hours worked per week
z1c_boys <- data_m$boys2 # binary: first two births boys 
z1c_girls <- data_m$girls2 # binary: first two births girls

ols.1c <- lm(d1c ~ z1c_boys + z1c_girls)
summ(ols.1c, robust = "HC1")

ols.2c <- ivreg(y1c ~ d1c  | z1c_boys + z1c_girls)
summary(ols.2c, vcov = sandwich, diagnostics = TRUE)

```
Among compliers, the impact of having more than two kids on hours worked is positive but still small and insignificant.

### (d)


### (e)
```{r}
d1e <- data_m$morekids # binary: had more than two kids
y1e <- data_m$hourswd # mens hours worked per week

ols.1e <- lm(y1e ~ d1e)
summ(ols.1e, robust = "HC1")
```

Using only OLS, we now see a negative (but still small and insignificant) effect of having kids on number of hours worked by the father. The standard error is now also much smaller. The difference between the 2SLS and the OLS likely comes from common causes of having more than two kids and hours worked per week by the father that are not being included in the analysis (i.e. unmeasured confounding). If this is the cause for the differences, then it would be preferred to do the 2SLS approach. There are, however, other possible reasons for these differences. For example, even in the absence of confounders, if the treatment effect is much different for compliers than for other segments of the population, then the estimates will be different. Additionally, it is also technically possible that it is not unobserved confounders but instead common causes of the instrument and the outcome that are driving the differences. Given that is is less likely for such variables to exist compared to treatment-outcome confounders, it is best to do the 2SLS approach here. 

## Question 2 - Estimating Effect of Fertility on Male Labour Supply - Two Stage Least Squares
### (a)
```{r}
median_age_m <- median(data$agem) 
data_om <- data %>% filter(agem > median_age_m) # households where woman is over median age 
data_um <- data %>% filter(agem <= median_age_m) # households where woman is under median age 

data_om$morekids %>% mean() %>% round(3)
data_um$morekids %>% mean() %>% round(3)
```

### (b)
```{r}
y2b <- data_um$weeksm
d2b <- data_um$morekids
x2b <- as.matrix(data_um[,c("agem", "agefstm", "blackm", "hispm", "othracem")])

ols.2b <- lm(y2b ~ d2b + x2b)
summ(ols.2b, robust = "HC1")

```

I do not think these variables are enough to alleviate potential endogeneity concerns. For example, things like religion and socioeconomic status may be correlated with having more kids and also have a causal relationship with the number of hours worked per work by mothers. If this were to be the case, the assumption of unfoundedness would be violated and our causal effect unidentifiable. 


### (c)
```{r}
#lm(morekids ~ samesex, data = data_um)

tsls_2c <- ivreg(weeksm ~ morekids | samesex, data = data_um)
summary(tsls_2c, vcov = sandwich, diagnostics = TRUE)

```

The effect of having more kids on hours worked per week by the mother is larger using the 2SLS approach versus the OLS.

### (d)
Not sure - maybe something to do with the fact that few people have "had the chance" to have more than two children - may decrease the relevance of the instrument?


## Question 3 - Replicating study with Switzerland data
### (a)
```{r}
# Are some households missing mothers or fathers?
data$hourswm %>% is.na() %>% sum()
data$hourswd %>% is.na() %>% sum()

# Check employment rates for men and women
women_er <- mean(na.omit(data$hourswm) > 0) %>% round(3) # women
men_er <- mean(na.omit(data$hourswd) > 0) %>% round(3) # men

# Check how common part time work is for men and women
women_pt <- mean((na.omit(data$hourswm) > 0) & (na.omit(data$hourswm) < 40)) %>% round(3) # women
men_pt <- mean((na.omit(data$hourswd) > 0) & (na.omit(data$hourswd) < 40)) %>% round(3) # men

women_men_df <- data.frame(Measure = c("Emp. Rate", "P.T. rate"), 
                           Women = c(women_er, women_pt),
                           Men = c(men_er, men_pt))

women_men_df
```
It is apparent that more mothers in Switzerland today participate in the labor market and, of those who work, more work full time, compared to those in the 1980s in the United States. On the other hand, fathers are less likely to work in general and are more likely to engage in part time work. This may be a consequence of more equal sharing of unpaid domestic work and formal participation in the labor market. Because of this, if we were to use data coming from Switzerland today, it is likely the effect in men would be greater and the effect in women be smaller. 

### (b)
To estimate the effect of fertility in labor supply in Switzerland today, we'd likely have to change the definition of our exposure. This is due to the fact that many people are having less than two children. One way to do this is to look at the impact of having more than one kid, instead of having more than two kids. Then, the first step would regress a dummy that indicates whether the household has more than one kid against the instrument. Then, the estimates of this exposure variable will be used in a model with labor supply outcomes as the response. If it is thought that sex itself influences whether or not someone will have another kid, then sex could be used as the instrument. 

```{r}

```

### (c)
Restricting ages to be between 21 and 35 might be problematic as women are now have children later and later (many are likely having additional children after the age of 35). Additionally, given the much lower fertility rate of Switzerland today compared to US back then, it perhaps be problematic to limit the analyses to those having more than two children. 


## Question 4 
### (a)
The Sargan test can be used to test the validity of the instrument. I don't really understand it. I think the idea is that the errors of the second stage regression should not be correlated with the instrumental variable. Because, this implies that there are common causes of the instrument and outcome, violating the "exclusion" principle.

Hausman test can be used to dermine if a given exposure of interest is endogenous. I don't really understand it. I think the principle is that if the exposure being used is exogenous (maybe conditioning on some things idk) then the 2SLS and IV approach should yield the same results, as the same treatment effect is being targeted.

### (b)
Sargan test - assumes homoskedastic errors, assumes at least one instrument is valid...

## Question 5
### (a) 
Data from 1990 is included to test the "local continuity" assumption that would require the potential outcomes to be continuous across all values of the win margin. If we would see a jump at 0 in the 1990 data, this would violate this assumption and indicate that those municipalities who had a small victory margin in 1994 differ systematically from those who barely lost. 

### (b)


### (c)
