---
title: "Assignment3_NP"
output: html_document
date: "2025-04-24"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Empty working space
rm(list=ls())

#Load Packages
# Define packages that you need, 
packages_vector <- c( "haven", "dplyr",  "sandwich",  "jtools", "fBasics",  
                     "xtable",  "stargazer", "data.table", "tidyverse", "ggplot2", 
                     "AER", # AER package for ivreg command 
                     "causalweight") # for semiparametric LATE
lapply(packages_vector, require, character.only = TRUE) 

```

```{r}
# Read in the data
load("C:/Users/putne/OneDrive/Documents/CausalInferencePolicyEvaluationSpring2025/Assignment3/instructions-and-setup/AngristEvans1980_reduced.RData")
```

```{r}
desc <- fBasics::basicStats(data) %>% 
                t() %>% 
                as.data.frame() %>% 
                dplyr::select(Mean, Stdev, nobs)

print("Descriptive statistics")
print(round(desc, digits=3))

glimpse(data)
Hmisc::describe(data)
```



## Question 1 - Estimating Effect of Fertility on Male Labour Supply - OLS
### (a)
```{r}
# Only include rows which describe a married couple
data_m <- data %>% filter(msample == 1)

print("Average Age and Income of Mothers and Fathers When First Child was Born")
age_income_df <- data.frame(Parent = c("Mother", "Father"), Age = c(data_m$agem %>% mean(), data_m$aged %>% mean()),
           Income = c(data_m$incomem %>% mean(), data_m$incomed %>% mean())) %>%
  mutate(across(c(Age, Income), ~ round(.x, 2)))

age_income_df
```

It appears that, within married couples, fathers are on average slightly older and have a substantially higher income then the mothers at the time their first child is born (39000 vs. 6200). Given that the men have a much higher income, it is possible that the decision is made within the couple for women to spend more time at home on domestic chores and looking after the child, while the man continues to work. 

### (b)
```{r}
d1b <- data_m$morekids # binary: had more than two kids
y1b <- data_m$hourswd # mens hours worked per week
z1b <- data_m$samesex # binary: first two children same sex

ols.1b <- lm(d1b ~ z1b)
summ(ols.1b, robust = "HC1")

ols.2b <- ivreg(y1b ~ d1b  | z1b)
summary(ols.2, vcov = sandwich, diagnostics = TRUE)
```
Among compilers (i.e. those who have a third kid if the first two are the same sex AND do not have a third kid if the first are a different sex), it seems having more than two kids has a small positive but insignificant effect on the number of hours worked for the fathers.

### (c)
```{r}
d1c <- data_m$morekids # binary: had more than two kids
y1c <- data_m$hourswd # mens hours worked per week
z1c_boys <- data_m$boys2 # binary: first two births boys 
z1c_girls <- data_m$girls2 # binary: first two births girls

ols.1c <- lm(d1c ~ z1c_boys + z1c_girls)
summ(ols.1c, robust = "HC1")

ols.2c <- ivreg(y1c ~ d1c  | z1c_boys + z1c_girls)
summary(ols.2c, vcov = sandwich, diagnostics = TRUE)

```
Among compliers, the impact of having more than two kids on hours worked is positive but still small and insignificant.

### (d)


### (e)
```{r}
d1e <- data_m$morekids # binary: had more than two kids
y1e <- data_m$hourswd # mens hours worked per week

ols.1e <- lm(y1e ~ d1e)
summ(ols.1e, robust = "HC1")
```

Using only OLS, we now see a negative (but still small and insignificant) effect of having kids on number of hours worked by the father. The standard error is now also much smaller. The difference between the 2SLS and the OLS likely comes from common causes of having more than two kids and hours worked per week by the father that are not being included in the analysis (i.e. unmeasured confounding). If this is the cause for the differences, then it would be preferred to do the 2SLS approach. There are, however, other possible reasons for these differences. For example, even in the absence of confounders, if the treatment effect is much different for compliers than for other segments of the population, then the estimates will be different. Additionally, it is also technically possible that it is not unobserved confounders but instead common causes of the instrument and the outcome that are driving the differences. Given that is is less likely for such variables to exist compared to treatment-outcome confounders, it is best to do the 2SLS approach here. 

## Question 2 - Estimating Effect of Fertility on Male Labour Supply - Two Stage Least Squares
### (a)
```{r}


```

### (b)
```{r}

```

### (c)
```{r}

```

### (d)
```{r}

```


## Question 3 - Replicating study with Switzerland data
### (a)
```{r}

```

### (b)
```{r}

```

### (c)
```{r}

```


## Question 4 


## Question 5
